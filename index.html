<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TempMail - Disposable Email Service</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root {
            --primary: #2A2F45;
            --secondary: #3A3F55;
            --accent: #6C63FF;
            --text: #FFFFFF;
            --text-muted: #A0A0A0;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', sans-serif;
        }

        body {
            background: var(--primary);
            color: var(--text);
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }

        .header {
            text-align: center;
            margin-bottom: 3rem;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
            background: linear-gradient(45deg, #6C63FF, #9F7AEA);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .email-section {
            background: var(--secondary);
            border-radius: 15px;
            padding: 2rem;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin-bottom: 2rem;
        }

        .email-controls {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .email-input {
            flex: 1;
            padding: 1rem;
            background: #40445A;
            border: none;
            border-radius: 8px;
            color: var(--text);
            font-size: 1rem;
        }

        .btn {
            padding: 1rem 1.5rem;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-weight: 600;
        }

        .btn-primary {
            background: var(--accent);
            color: white;
        }

        .btn-secondary {
            background: #40445A;
            color: var(--text);
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(108, 99, 255, 0.3);
        }

        .email-list {
            background: var(--secondary);
            border-radius: 15px;
            overflow: hidden;
        }

        .email-item {
            padding: 1.5rem;
            border-bottom: 1px solid #40445A;
            transition: all 0.3s ease;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .email-item:hover {
            background: #40445A;
        }

        .email-sender {
            font-weight: 600;
            color: var(--accent);
        }

        .email-subject {
            flex: 1;
            margin: 0 1.5rem;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .email-time {
            color: var(--text-muted);
            font-size: 0.9rem;
        }

        .empty-state {
            text-align: center;
            padding: 3rem;
            color: var(--text-muted);
        }

        @media (max-width: 768px) {
            .container {
                padding: 1rem;
            }
            
            .email-controls {
                flex-direction: column;
            }
            
            .email-item {
                flex-direction: column;
                align-items: flex-start;
                gap: 0.5rem;
            }
            
            .email-subject {
                margin: 0;
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header class="header">
            <h1>TempMail</h1>
            <p>Disposable Temporary Email Service</p>
        </header>

        <section class="email-section">
            <div class="email-controls">
                <input type="text" class="email-input" id="emailAddress" readonly placeholder="Click generate to create email">
                <button class="btn btn-primary" onclick="generateEmail()">
                    <i class="fas fa-plus"></i>
                    Generate
                </button>
                <button class="btn btn-secondary" id="refreshButton">
                    <i class="fas fa-sync"></i>
                    Refresh
                </button>
            </div>

            <div class="email-list" id="emailList">
                <div class="empty-state">
                    <i class="fas fa-inbox fa-2x"></i>
                    <p>No emails received yet</p>
                </div>
            </div>
        </section>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/dompurify@2.3.6/dist/purify.min.js"></script>
    <script>
        let currentToken = localStorage.getItem('emailToken') || '';
        let currentEmail = localStorage.getItem('currentEmail') || '';
        let isLoading = false;

        async function generateEmail() {
            try {
                const response = await fetch('https://api.tempmail.lol/generate');
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const data = await response.json();
                if (!data.address || !data.token) {
                    throw new Error('Invalid response from API');
                }
                currentToken = data.token;
                currentEmail = data.address;
                
                localStorage.setItem('emailToken', currentToken);
                localStorage.setItem('currentEmail', currentEmail);
                
                document.getElementById('emailAddress').value = currentEmail;
                loadEmails();
            } catch (error) {
                alert('Error generating email: ' + error.message);
            }
        }

        async function loadEmails() {
            if (isLoading) return;
            isLoading = true;
            if (!currentToken) {
                isLoading = false;
                return;
            }
            try {
                const response = await fetch(`https://api.tempmail.lol/messages?token=${currentToken}`);
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const emails = await response.json();
                
                const emailList = document.getElementById('emailList');
                emailList.innerHTML = '';
                
                if (emails.length === 0) {
                    emailList.innerHTML = `
                        <div class="empty-state">
                            <i class="fas fa-inbox fa-2x"></i>
                            <p>No emails received yet</p>
                        </div>
                    `;
                    return;
                }
                
                emails.forEach(email => {
                    const emailElement = document.createElement('div');
                    emailElement.className = 'email-item';
                    emailElement.innerHTML = `
                        <div class="email-sender">${email.from}</div>
                        <div class="email-subject">${email.subject}</div>
                        <div class="email-time">${new Date(email.timestamp).toLocaleTimeString()}</div>
                    `;
                    emailElement.addEventListener('click', () => showEmailContent(email));
                    emailList.appendChild(emailElement);
                });
            } catch (error) {
                alert('Error loading emails: ' + error.message);
            } finally {
                isLoading = false;
            }
        }

        function showEmailContent(email) {
            const sanitizedContent = DOMPurify.sanitize(email.html || email.text);
            const contentWindow = window.open('', '_blank');
            contentWindow.document.write(`
                <html>
                <head>
                    <title>${email.subject}</title>
                    <style>
                        body { 
                            padding: 2rem; 
                            max-width: 800px; 
                            margin: 0 auto;
                            font-family: sans-serif;
                        }
                    </style>
                </head>
                <body>
                    <h1>${email.subject}</h1>
                    <p><strong>From:</strong> ${email.from}</p>
                    <p><strong>Date:</strong> ${new Date(email.timestamp).toLocaleString()}</p>
                    <hr>
                    <div>${sanitizedContent}</div>
                </body>
                </html>
            `);
        }

        // UI improvements for refresh button with circular movement
        const refreshButton = document.getElementById('refreshButton');
        refreshButton.addEventListener('click', function() {
            if (isLoading) return;
            refreshButton.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Refreshing...';
            refreshButton.setAttribute('disabled', 'disabled');
            loadEmails().then(() => {
                refreshButton.removeAttribute('disabled');
                refreshButton.innerHTML = '<i class="fas fa-sync"></i> Refresh';
            }).catch(() => {
                refreshButton.removeAttribute('disabled');
                refreshButton.innerHTML = '<i class="fas fa-sync"></i> Refresh';
            });
        });

        // Automatic refresh every 10 seconds
        setInterval(() => {
            if (currentToken && !isLoading) {
                loadEmails();
            }
        }, 10000);

        // Initial load
        if (currentEmail) {
            document.getElementById('emailAddress').value = currentEmail;
            loadEmails();
        }
    </script>
</body>
</html>